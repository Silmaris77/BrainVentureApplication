import streamlit as st
import os
import sys
import json

# Add the project root to the path
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from utils.ui import card, grid
from config.app_config import APP_NAME, APP_DESCRIPTION, APP_ICON

# Define functions
def load_course_structure():
    """Load the course structure from a JSON file or return default structure."""
    try:
        with open(os.path.join("data", "content", "course_structure.json"), "r", encoding="utf-8") as f:
            return json.load(f)
    except FileNotFoundError:
        # Return default structure (first block only for MVP)
        return [
            {
                "emoji": "üî•",
                "title": "Neurobiologia przyw√≥dztwa",
                "modules": [
                    {
                        "title": "üß† Wprowadzenie do neuroprzyw√≥dztwa",
                        "lessons": [
                            {"title": "Co to jest neuroprzyw√≥dztwo?", "completed": True},
                            {"title": "M√≥zg lidera ‚Äì struktura i funkcje"},
                            {"title": "Neuronaukowe podstawy podejmowania decyzji"},
                            {"title": "Jak m√≥zg przetwarza stres i zmienno≈õƒá?"},
                            {"title": "Neurobiologia emocji a zarzƒÖdzanie"},
                            {"title": "Rola oksytocyny w przyw√≥dztwie"},
                            {"title": "Dopamina ‚Äì motywacja i nagroda"},
                            {"title": "Neuroprzyw√≥dztwo a zarzƒÖdzanie stresem"},
                            {"title": "Przewodzenie w kontek≈õcie teorii neurobiologicznych"},
                            {"title": "Neuroprzyw√≥dztwo w praktyce ‚Äì przyk≈Çady z ≈ºycia"}
                        ]
                    },
                    {
                        "title": "üí° M√≥zg, emocje i decyzje",
                        "lessons": [
                            {"title": "Jak emocje wp≈ÇywajƒÖ na decyzje lider√≥w?"},
                            {"title": "Rola limbicznego uk≈Çadu w podejmowaniu decyzji"},
                            {"title": "Przeciwdzia≈Çanie b≈Çƒôdom poznawczym"},
                            {"title": "Jak zrozumieƒá emocje w pracy zespo≈Çowej?"},
                            {"title": "Mechanizmy adaptacji do stresu"},
                            {"title": "Inteligencja emocjonalna lidera"},
                            {"title": "Decyzje pod wp≈Çywem emocji a efektywno≈õƒá"},
                            {"title": "M√≥zg a odporno≈õƒá na krytykƒô"},
                            {"title": "Przyk≈Çady z ≈ºycia lider√≥w: jak radzili sobie z emocjami"},
                            {"title": "Neurobiologia wsp√≥≈Çczucia w przyw√≥dztwie"}
                        ]
                    },
                    {
                        "title": "Mechanizmy m√≥zgu w interakcjach spo≈Çecznych",
                        "lessons": [
                            {"title": "Wsp√≥≈Çczucie jako narzƒôdzie przyw√≥dcze"},
                            {"title": "Jak m√≥zg interpretuje zachowanie innych?"},
                            {"title": "Neurologiczne podstawy komunikacji"},
                            {"title": "ZarzƒÖdzanie konfliktem ‚Äì m√≥zg i emocje"},
                            {"title": "Teoria przyw√≥dztwa opartego na empatii"},
                            {"title": "M√≥zg gadzi vs. racjonalny: jak to wp≈Çywa na decyzje?"},
                            {"title": "Jak skutecznie motywowaƒá zesp√≥≈Ç?"},
                            {"title": "Mechanizmy wp≈Çywu i perswazji"},
                            {"title": "Neuroprzyw√≥dztwo a budowanie relacji"},
                            {"title": "M√≥zg a dynamika grupy"}
                        ]
                    }
                ]
            }
        ]

# Page title for sidebar
st.set_page_config(page_title="Dashboard", page_icon="üè†")

# Apply custom CSS
css_path = os.path.join("static", "css", "style.css")
if os.path.exists(css_path):
    with open(css_path, "r", encoding='utf-8') as f:
        st.markdown(f"<style>{f.read()}</style>", unsafe_allow_html=True)

# Define the load_course_structure function before using it
def load_course_structure():
    """Load the course structure from a JSON file or return default structure."""
    try:
        with open(os.path.join("data", "content", "course_structure.json"), "r", encoding="utf-8") as f:
            return json.load(f)
    except FileNotFoundError:
        # Return default structure (first block only for MVP)
        return [
            {
                "emoji": "üî•",
                "title": "Neurobiologia przyw√≥dztwa",
                "modules": [
                    {
                        "title": "üß† Wprowadzenie do neuroprzyw√≥dztwa",
                        "lessons": [
                            {"title": "Co to jest neuroprzyw√≥dztwo?", "completed": True},
                            {"title": "M√≥zg lidera ‚Äì struktura i funkcje"},
                            {"title": "Neuronaukowe podstawy podejmowania decyzji"},
                            {"title": "Jak m√≥zg przetwarza stres i zmienno≈õƒá?"},
                            {"title": "Neurobiologia emocji a zarzƒÖdzanie"},
                            {"title": "Rola oksytocyny w przyw√≥dztwie"},
                            {"title": "Dopamina ‚Äì motywacja i nagroda"},
                            {"title": "Neuroprzyw√≥dztwo a zarzƒÖdzanie stresem"},
                            {"title": "Przewodzenie w kontek≈õcie teorii neurobiologicznych"},
                            {"title": "Neuroprzyw√≥dztwo w praktyce ‚Äì przyk≈Çady z ≈ºycia"}
                        ]
                    },
                    {
                        "title": "üí° M√≥zg, emocje i decyzje",
                        "lessons": [
                            {"title": "Jak emocje wp≈ÇywajƒÖ na decyzje lider√≥w?"},
                            {"title": "Rola limbicznego uk≈Çadu w podejmowaniu decyzji"},
                            {"title": "Przeciwdzia≈Çanie b≈Çƒôdom poznawczym"},
                            {"title": "Jak zrozumieƒá emocje w pracy zespo≈Çowej?"},
                            {"title": "Mechanizmy adaptacji do stresu"},
                            {"title": "Inteligencja emocjonalna lidera"},
                            {"title": "Decyzje pod wp≈Çywem emocji a efektywno≈õƒá"},
                            {"title": "M√≥zg a odporno≈õƒá na krytykƒô"},
                            {"title": "Przyk≈Çady z ≈ºycia lider√≥w: jak radzili sobie z emocjami"},
                            {"title": "Neurobiologia wsp√≥≈Çczucia w przyw√≥dztwie"}
                        ]
                    },
                    {
                        "title": "Mechanizmy m√≥zgu w interakcjach spo≈Çecznych",
                        "lessons": [
                            {"title": "Wsp√≥≈Çczucie jako narzƒôdzie przyw√≥dcze"},
                            {"title": "Jak m√≥zg interpretuje zachowanie innych?"},
                            {"title": "Neurologiczne podstawy komunikacji"},
                            {"title": "ZarzƒÖdzanie konfliktem ‚Äì m√≥zg i emocje"},
                            {"title": "Teoria przyw√≥dztwa opartego na empatii"},
                            {"title": "M√≥zg gadzi vs. racjonalny: jak to wp≈Çywa na decyzje?"},
                            {"title": "Jak skutecznie motywowaƒá zesp√≥≈Ç?"},
                            {"title": "Mechanizmy wp≈Çywu i perswazji"},
                            {"title": "Neuroprzyw√≥dztwo a budowanie relacji"},
                            {"title": "M√≥zg a dynamika grupy"}
                        ]
                    }
                ]
            }
        ]

# Page content
st.title("üß† BrainVenture - Dashboard")
st.markdown("""
Witaj w programie BrainVenture! To kompleksowy kurs neuroprzyw√≥dztwa, 
kt√≥ry pomo≈ºe Ci rozwinƒÖƒá umiejƒôtno≈õci przyw√≥dcze w oparciu o najnowsze 
odkrycia z dziedziny neurobiologii.
""")

# Progress card
st.markdown("### Tw√≥j postƒôp")
cols = st.columns([2, 1])
with cols[0]:
    st.progress(0.05)
    st.write("5% kursu uko≈Ñczone")
with cols[1]:
    st.metric(label="Uko≈Ñczone lekcje", value="1/150")

st.markdown("---")

# Load course structure
course_structure = load_course_structure()

# Display blocks
st.markdown("## Struktura kursu")

for block_idx, block in enumerate(course_structure):
    with st.expander(f"{block['emoji']} Blok {block_idx+1}: {block['title']}", expanded=block_idx==0):
        st.markdown(f"### {block['title']}")
        
        for module_idx, module in enumerate(block['modules']):
            st.markdown(f"#### Modu≈Ç {module_idx+1}: {module['title']}")
            
            # Create a grid of lesson cards
            cols = st.columns(3)
            for lesson_idx, lesson in enumerate(module['lessons']):
                col_idx = lesson_idx % 3
                with cols[col_idx]:
                    st.markdown(f"""
                    <div style="border:1px solid #ddd; padding:10px; border-radius:5px; margin-bottom:10px">
                    <h5>{lesson_idx+1}. {lesson['title']}</h5>
                    <div style="color:#888; font-size:0.8em;">
                    {'‚úÖ Uko≈Ñczono' if lesson.get('completed', False) else 'üîí Zablokowane'}
                    </div>
                    </div>
                    """, unsafe_allow_html=True)

def load_course_structure():
    """Load the course structure from a JSON file or return default structure."""
    try:
        with open(os.path.join("data", "content", "course_structure.json"), "r", encoding="utf-8") as f:
            return json.load(f)
    except FileNotFoundError:
        # Return default structure (first block only for MVP)
        return [
            {
                "emoji": "üî•",
                "title": "Neurobiologia przyw√≥dztwa",
                "modules": [
                    {
                        "title": "üß† Wprowadzenie do neuroprzyw√≥dztwa",
                        "lessons": [
                            {"title": "Co to jest neuroprzyw√≥dztwo?", "completed": True},
                            {"title": "M√≥zg lidera ‚Äì struktura i funkcje"},
                            {"title": "Neuronaukowe podstawy podejmowania decyzji"},
                            {"title": "Jak m√≥zg przetwarza stres i zmienno≈õƒá?"},
                            {"title": "Neurobiologia emocji a zarzƒÖdzanie"},
                            {"title": "Rola oksytocyny w przyw√≥dztwie"},
                            {"title": "Dopamina ‚Äì motywacja i nagroda"},
                            {"title": "Neuroprzyw√≥dztwo a zarzƒÖdzanie stresem"},
                            {"title": "Przewodzenie w kontek≈õcie teorii neurobiologicznych"},
                            {"title": "Neuroprzyw√≥dztwo w praktyce ‚Äì przyk≈Çady z ≈ºycia"}
                        ]
                    },
                    {
                        "title": "üí° M√≥zg, emocje i decyzje",
                        "lessons": [
                            {"title": "Jak emocje wp≈ÇywajƒÖ na decyzje lider√≥w?"},
                            {"title": "Rola limbicznego uk≈Çadu w podejmowaniu decyzji"},
                            {"title": "Przeciwdzia≈Çanie b≈Çƒôdom poznawczym"},
                            {"title": "Jak zrozumieƒá emocje w pracy zespo≈Çowej?"},
                            {"title": "Mechanizmy adaptacji do stresu"},
                            {"title": "Inteligencja emocjonalna lidera"},
                            {"title": "Decyzje pod wp≈Çywem emocji a efektywno≈õƒá"},
                            {"title": "M√≥zg a odporno≈õƒá na krytykƒô"},
                            {"title": "Przyk≈Çady z ≈ºycia lider√≥w: jak radzili sobie z emocjami"},
                            {"title": "Neurobiologia wsp√≥≈Çczucia w przyw√≥dztwie"}
                        ]
                    },
                    {
                        "title": "Mechanizmy m√≥zgu w interakcjach spo≈Çecznych",
                        "lessons": [
                            {"title": "Wsp√≥≈Çczucie jako narzƒôdzie przyw√≥dcze"},
                            {"title": "Jak m√≥zg interpretuje zachowanie innych?"},
                            {"title": "Neurologiczne podstawy komunikacji"},
                            {"title": "ZarzƒÖdzanie konfliktem ‚Äì m√≥zg i emocje"},
                            {"title": "Teoria przyw√≥dztwa opartego na empatii"},
                            {"title": "M√≥zg gadzi vs. racjonalny: jak to wp≈Çywa na decyzje?"},
                            {"title": "Jak skutecznie motywowaƒá zesp√≥≈Ç?"},
                            {"title": "Mechanizmy wp≈Çywu i perswazji"},
                            {"title": "Neuroprzyw√≥dztwo a budowanie relacji"},
                            {"title": "M√≥zg a dynamika grupy"}
                        ]
                    }
                ]
            }
        ]
